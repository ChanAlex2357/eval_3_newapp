<div th:replace="~{layouts/default :: layout(title='Newapp | Employees list', content=~{::content})}">
    <th:block th:fragment="content">
        <div class="bg-light">
            <div class="container">

                <div th:if="${employee == null}">
                    <div class="card ">
                        <div class="card-body">
                            <p th:text="${error_msg}"></p>
                        </div>
                    </div>
                </div>
                <div th:unless="${employee == null}">
                    <table class="table">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Employee</th>
                            <th scope="col">Genre</th>
                            <th scope="col">Date d'embauche</th>
                        </tr>
                        <tr>
                            <td id="emp_name" th:attr="data-employee-id=${employee.name}" th:text="${employee.getName()}"></td>
                            <td th:text="${employee.getFirstname()}"></td>
                            <td th:text="${employee.getGender()}"></td>
                            <td th:text="${employee.getJoinDate()}"></td>
                        </tr>
                    </table>
                </div>
                <hr>
                <div class="row">
                    <div class="col-6">
                        <h2 class="text-center">Fiches de paies</h2>
                        <table class="table table-striped" id="salaryTable">
                            <thead>
                                <th scope="col">#</th>
                                <th scope="col">Period</th>
                                <th scope="col">Salary</th>
                            </thead>
                            <tbody id="salariesBody">
                                <tr>
                                    <td colspan="8">      
                                        <div class="d-flex justify-content-center">
                                            <div class="spinner-border" role="status">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="col-6">
                        <h2 class="text-center">Historique de salaires</h2>
                        <table class="table table-striped">
                            <thead>
                                <th scope="col">#</th>
                                <th scope="col">Date debut</th>
                                <th scope="col">Salaire</th>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>    
        <script type="module">
            import {downloadSalaryPdf, fetchSalaries} from '/js/metier.js'

            async function fetchData() {
                const emp_name = document.getElementById("emp_name").dataset.employeeId;
                const data = await fetchSalaries({"employee":emp_name});
                console.log(data);
                renderSalariesTable(data.salaries);

            }

            function renderSalariesTable(data){
                const tbody = document.getElementById("salariesBody");
                tbody.innerHTML =""
                if(data.length == 0){
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8">      
                                <div class="d-flex justify-content-center">
                                    <span class="m-5">Aucun salaire trouvee</span>
                                </div>
                            </td>
                        </tr>
                    `;
                    return
                }

                data.forEach((salary) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <tr>
                            <td>${salary.name}</td>
                            <td>${salary.start_date}</td>
                            <td>${salary.net_pay}</td>
                        </tr>
                    `
                    tbody.appendChild(row);
                });
            }
            document.addEventListener("DOMContentLoaded",(e)=>{
                fetchData()
            })
        </script>

    </th:block>
</div>