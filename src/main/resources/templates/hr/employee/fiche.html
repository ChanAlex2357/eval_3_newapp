<div th:replace="~{layouts/default :: layout(title='Newapp | Employees list', content=~{::content})}">
    <th:block th:fragment="content">
        <div class="bg-light">
            <div class="container">

                <div th:if="${employee == null}">
                    <div class="card ">
                        <div class="card-body">
                            <p th:text="${error_msg}"></p>
                        </div>
                    </div>
                </div>
                <div th:unless="${employee == null}">
                    <table class="table">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Employee</th>
                            <th scope="col">Genre</th>
                            <th scope="col">Date d'embauche</th>
                        </tr>
                        <tr>
                            <td id="emp_name" th:attr="data-employee-id=${employee.name}" th:text="${employee.getName()}"></td>
                            <td th:text="${employee.getFirstname()}"></td>
                            <td th:text="${employee.getGender()}"></td>
                            <td th:text="${employee.getJoinDate()}"></td>
                        </tr>
                    </table>
                </div>

                <h2>Salaires</h2>
                <div th:unless="${salaries == null}">
                    <table class="table" id="salaryTable">
                        <thead>
                            <th scope="col">#</th>
                            <th scope="col">Start Date</th>
                            <th scope="col">End Date</th>
                            <th scope="col">Salary</th>
                            <th scope="col">Brut</th>
                            <th scope="col">Net</th>
                        </thead>
                        <tbody>
                            <tr th:each=" salary : ${salaries}">
                                <td th:text="${salary.getName()}"></td>
                                <td th:text="${salary.getStartDate()}"></td>
                                <td th:text="${salary.getEndDate()}"></td>
                                <td th:text="${salary.getSalaryStructure()}"></td>
                                <td th:text="${salary.getGrossPay()}"></td>
                                <td th:text="${salary.getNetPay()}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>    
        <script type="module">
            import {downloadSalaryPdf, fetchSalaries} from '/js/metier.js'

            async function fetchData() {
                const emp_name = document.getElementById("emp_name").dataset.employeeId;
                const salaries = await fetchSalaries({"employee":emp_name});
                console.log(salaries);
            }
            document.addEventListener("DOMContentLoaded",(e)=>{
                fetchData()
            })
        </script>
    </th:block>
</div>